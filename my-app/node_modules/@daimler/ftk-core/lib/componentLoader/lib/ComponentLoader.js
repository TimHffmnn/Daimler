"use strict";
// SPDX-License-Identifier: MIT
// Copyright (c) 2020 Daimler TSS GmbH
Object.defineProperty(exports, "__esModule", { value: true });
var lodash_1 = require("lodash");
var ScriptLoader_1 = require("../../util/loader/ScriptLoader");
/**
 * Uses ajax calls using {@link https://github.com/ded/script.js ScriptJs} to load external
 * swidget compiled into standalone .js files.
 */
var ComponentLoader = /** @class */ (function () {
    function ComponentLoader() {
    }
    ComponentLoader.prototype.load = function (options) {
        var scriptLoader = new ScriptLoader_1.ScriptLoader(options.url);
        return new Promise(function (resolve, reject) {
            scriptLoader
                .loadScript()
                .then(function () {
                var swidget = lodash_1.get(window, options.name + ".default", null);
                if (swidget && !swidget.metadata) {
                    reject(new Error("Swidget metadata not found. Are you trying to load a swidget without metadata?"));
                }
                else if (swidget && swidget.metadata) {
                    resolve(swidget);
                }
                else {
                    reject(new Error("Swidget ComponentLoader: can't load swidget with name " + options.name + "."));
                }
            })
                .catch(function (errLog) {
                var errorMessage = "Swidget ComponentLoader: can't load swidget with url " + options.url + ".";
                if (errLog.error) {
                    errorMessage = "Swidget ComponentLoader: can't load swidget with name " + options.name + ". \n Error: " + errLog.error.message;
                }
                reject(new Error(errorMessage));
            });
        });
    };
    return ComponentLoader;
}());
exports.default = ComponentLoader;
//# sourceMappingURL=ComponentLoader.js.map